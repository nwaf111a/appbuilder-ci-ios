env:
  global:
    - APPBUILDER_ASSET=default.ipa
    - APPBUILDER_ASSET_DOWNLOAD_PATH=s3://sil-stg-aps-files/default
    - APPBUILDER_ASSET_RESULT_PATH=s3://sil-stg-aps-files/stg/signed
    - APPBUILDER_SECRETS_PATH=s3://sil-stg-aps-secrets/travis/build

os: osx
language: shell

stages:
  - "Sign IPA"

jobs:
  include:
    - stage: "Sign IPA"
      if: branch = master
      language: generic
      before_install:
      - python --version
      - >
        time (
          wget "https://s3.amazonaws.com/aws-cli/awscli-bundle.zip"
          unzip awscli-bundle.zip
          sudo ./awscli-bundle/install -i /usr/local/aws -b /usr/local/bin/aws
        )
      - which aws
      script:
        - time ( ./download_secrets.sh )
        - time ( ./download_asset.sh )
        - time ( ./resign_asset.sh )
        - time ( ./upload_asset.sh )
