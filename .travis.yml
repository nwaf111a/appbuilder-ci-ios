env:
  global:
    - APPBUILDER_ASSET=default.ipa
    - APPBUILDER_ASSET_DOWNLOAD_PATH=s3://sil-stg-aps-files/default
    - APPBUILDER_ASSET_RESULT_PATH=s3://sil-stg-aps-files/stg/signed
    - APPBUILDER_SECRETS_PATH=s3://sil-stg-aps-secrets/travis/build

os: osx
language: shell

stages:
  - "Install"
  - "Download"
  - "Builder"
  - "Sign IPA"

jobs:
  include:
    - stage: "Install"
      script:
      - time ( ./install_aws_cli.sh )
      - time ( cd ansible && ansible-playbook playbook.yml )
    - stage: "Download"
      script:
        - time ( ./download_secrets.sh )
        - time ( ./download_asset.sh )
    - stage: "Builder"
      script:
        - time ( ./builder.sh )
    - stage: "Sign IPA"
      if: branch = master
      language: generic
        - time ( ./resign_asset.sh )
        - time ( ./upload_asset.sh )
